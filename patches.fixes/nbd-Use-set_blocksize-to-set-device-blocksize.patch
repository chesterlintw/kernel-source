From c8a83a6b54d0ca078de036aafb3f6af58c1dc5eb Mon Sep 17 00:00:00 2001
From: Jan Kara <jack@suse.cz>
Date: Mon, 14 Jan 2019 09:48:09 +0100
Subject: [PATCH] nbd: Use set_blocksize() to set device blocksize
Git-commit: c8a83a6b54d0ca078de036aafb3f6af58c1dc5eb
Patch-mainline: v5.0-rc3
References: bsc#1124984

NBD can update block device block size implicitely through
bd_set_size(). Make it explicitely set blocksize with set_blocksize() as
this behavior of bd_set_size() is going away.

Cc: Josef Bacik <jbacik@fb.com>
Signed-off-by: Jan Kara <jack@suse.cz>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Jan Kara <jack@suse.cz>

---
 drivers/block/nbd.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/block/nbd.c
+++ b/drivers/block/nbd.c
@@ -1088,6 +1088,7 @@ static int nbd_start_device_ioctl(struct
 		return ret;
 
 	bd_set_size(bdev, config->bytesize);
+	set_blocksize(bdev, config->blksize);
 	if (max_part)
 		bdev->bd_invalidated = 1;
 	mutex_unlock(&nbd->config_lock);
